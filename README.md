
# test task

## Описание проекта

Проект представляет собой сервис на FastAPI с использованием PostgreSQL, предназначенный для обработки запросов, отправки сообщений в Telegram и управления доступом на основе ролей. Реализована система аутентификации с использованием JWT-токенов.

---

## Функционал проекта

1. **Аутентификация и авторизация:**
   - Реализована система ролей:
     - **Админ**: имеет полный доступ ко всем записям.
     - **Менеджер**: имеет доступ ко всем записям пользователей, которые находятся под его управлением.
     - **Юзер**: имеет доступ только к своим записям.
   - Аутентификация осуществляется через JWT-токены.

2. **Приём JSON-запросов:**
   - Сервис принимает POST-запросы с данными в формате JSON:
     ```json
     {
       "bottoken": "xxxxxxxx",
       "chatid": "123123123",
       "message": "foo bar"
     }
     ```
   - Данные запроса, включая ответ Telegram API и информацию об отправителе, сохраняются в базе данных.

3. **Отправка сообщений в Telegram:**
   - Сообщение отправляется с использованием предоставленных `bottoken` и `chatid`.
   - Ответ от Telegram API записывается в базу данных.

4. **База данных PostgreSQL:**
   - Хранятся данные о пользователях, ролях и запросах.
   - Организованы связи между таблицами для управления доступом.

5. **API для работы с записями:**
   - Эндпоинты для создания и чтения запросов.
   - Ограничения доступа на основе роли текущего пользователя.

    
## Запуск проекта

1. **Подготовка окружения:**
   - Убедитесь, что установлен Python 3.10 или выше.
   - Установите зависимости:
     ```bash
     pip install -r requirements.txt
     ```

2. **Настройка базы данных:**
   - Убедитесь, что PostgreSQL запущен.
   - Создайте базу данных.
   - Укажите настройки подключения в файле `.env`:
     ```
     DATABASE_URL=postgresql://username:password@localhost/dbname
     ```


3**Запуск приложения:**
   - В файле `.env` указать ключ `SECRET_KEY`
   - Запустите приложение:
   ```bash
   uvicorn app.main:app --reload
   ```

4**Доступ к документации:**
   - Откройте [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs) для просмотра Swagger UI.
   - Залогируйтесь по одному из пользователей (администратор, менеджер, юзер)(пароли и логины можно найти в бд).
   - Тестируйте апи


---

## Эндпоинты API

### Аутентификация

**POST /token**  
Получение JWT-токена.

Пример:
```json
{
  "username": "manager1",
  "password": "password123"
}
```

---

### Пользователи

**POST /users/create**  
Создание пользователя.

Пример:
```json
{
  "username": "new_user",
  "password": "password123",
  "role": "user"
}
```

**GET /users/**  
Получение списка пользователей (доступно для админов).

---

### Запросы

**POST /requests/**  
Отправка запроса и запись его в базу.

Пример:
```json
{
  "bottoken": "xxxxxxxx",
  "chatid": "123123123",
  "message": "foo bar"
}
```

**GET /requests/**  
Получение списка запросов:
- Администратор видит все запросы.
- Менеджер видит запросы пользователей под его управлением.
- Пользователь видит только свои запросы.



